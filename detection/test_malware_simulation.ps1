# ============================================================
# SIMULATION DE MALWARE POUR TEST DE DETECTION
# ============================================================
# Ce script est INOFFENSIF et sert uniquement a tester
# les capacites de detection de Velociraptor
#
# Techniques MITRE ATT&CK simulees:
# - T1059.001: PowerShell
# - T1082: System Information Discovery
# - T1083: File and Directory Discovery
# - T1057: Process Discovery
# - T1018: Remote System Discovery
# ============================================================

Write-Host "=== SIMULATION MALWARE - TEST DETECTION ===" -ForegroundColor Yellow
Write-Host "Ce script est INOFFENSIF - a des fins educatives uniquement" -ForegroundColor Green

# T1082 - System Information Discovery
Write-Host "`n[TEST] T1082 - System Information Discovery" -ForegroundColor Cyan
$systemInfo = @{
    "ComputerName" = $env:COMPUTERNAME
    "UserName" = $env:USERNAME
    "Domain" = $env:USERDOMAIN
    "OS" = (Get-WmiObject Win32_OperatingSystem).Caption
}
$systemInfo | Format-Table

# T1083 - File and Directory Discovery (simulation)
Write-Host "`n[TEST] T1083 - File and Directory Discovery" -ForegroundColor Cyan
$sensitiveLocations = @(
    "C:\Users\*\Documents\*.txt",
    "C:\Users\*\Desktop\*.docx",
    "C:\Users\*\AppData\Local\Google\Chrome\User Data\Default\Login Data"
)
Write-Host "Locations sensibles simulees (non accedees):"
$sensitiveLocations | ForEach-Object { Write-Host "  - $_" }

# T1057 - Process Discovery
Write-Host "`n[TEST] T1057 - Process Discovery" -ForegroundColor Cyan
Get-Process | Select-Object -First 5 Name, Id, CPU | Format-Table

# T1018 - Remote System Discovery (simulation)
Write-Host "`n[TEST] T1018 - Remote System Discovery" -ForegroundColor Cyan
Write-Host "Commande simulee: net view /domain (non executee)"

# Creer un fichier marqueur pour la detection
$markerPath = "$env:TEMP\malware_simulation_marker.txt"
$markerContent = @"
=== FICHIER MARQUEUR DE TEST ===
Date: $(Get-Date)
Machine: $env:COMPUTERNAME
User: $env:USERNAME
Purpose: Test de detection Velociraptor
Ce fichier est INOFFENSIF
"@
$markerContent | Out-File -FilePath $markerPath -Encoding UTF8

Write-Host "`n[INFO] Fichier marqueur cree: $markerPath" -ForegroundColor Green
Write-Host "`n=== FIN DE LA SIMULATION ===" -ForegroundColor Yellow
